---
title: "Data Manipulation with R"
subtitle: "BioMarin Meetup: transforming, reformatting, and calculating variables"
author: 
  - "Martin Frigaard"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
---

```{r setup, include=FALSE}
library(tidyverse)
library(reprex)
library(xaringan)
library(pagedown)
library(xaringanthemer)
# folders
folders <- c("code", "data", "img", "docs", "pdfs")
purrr::map(.x = folders, .f = fs::dir_create)
# chunk options
knitr::opts_chunk$set(warning = FALSE, message = FALSE, fig.align = "center", 
                      dpi = 320, fig.height = 4, fig.path = "img/")
# set options
options(htmltools.dir.version = FALSE, 
        tibble.max_extra_cols = 6,
        ibble.print_max = 6,
        tibble.width = 60)
```
class: middle, center

```{r xaringan-themer, include=FALSE, warning=FALSE}
xaringanthemer::style_duo_accent(primary_color = "#035AA6", secondary_color = "#03A696")
# xaringan::inf_mr() # for instant knitting and reviewing
```

```{r inf_mr, eval=FALSE, include=FALSE}
xaringan::inf_mr()
```

class: inverse, center, bottom
background-image: url(img/dplyr.png)
background-position: 50% 10%
background-size: 35%

# `dplyr` = a grammar for data manipulation

---
class: left, top
background-image: url(img/dplyr.png)
background-position: 95% 10%
background-size: 9%

# What are common data manipulation tasks?

### 1) Viewing the dataset

### 2). Choosing columns/rows 

### 3). Ordering rows (either alphabetically or numerically)

### 4). Reformating/changing values  

### 5). Creating or calculating new columns 

---
class: left, top
background-image: url(img/dplyr.png)
background-position: 95% 10%
background-size: 9%

# `dplyr` = "dee + ply + ARRRR"

<br>

.pull-left[

### *Pliers* are tools for grasping or manipulating common objects 

### The `dplyr` package has a variety of verbs for performing common data manipulations

]

--

<br>

.pull-right[

```{r pliers, out.height='80%', out.width='80%', echo=FALSE}
knitr::include_graphics(path = "img/pliers.png")
```

]

---
class: left, top
background-image: url(img/dplyr.png)
background-position: 90% 10%
background-size: 9%

# The `starwars` dataset  

### These data come from the Star Wars API: 

```{r star-wars-jpeg, out.height='60%', out.width='60%', echo=FALSE}
knitr::include_graphics(path = "img/star-wars.jpeg")
```

--

### Read more about the data here: https://dplyr.tidyverse.org/reference/starwars.html

---
class: left, top
background-image: url(img/dplyr.png)
background-position: 95% 9%
background-size: 9%

# Load the `starwars` dataset

### The `starwars` data comes from the `dplyr` package, so we can access it using the code below:

```{r starwars-dplyr, eval=FALSE}
install.packages("dplyr")
library(dplyr)
dplyr::starwars
```

--

### We'll use a smaller version of this dataset (`original_starwars`) to show `dplyr`'s common data manipluation verbs


---
class: left, top
background-image: url(img/dplyr.png)
background-position: 5% 95%
background-size: 7%

# Import `orginal_starwars` 

--

### Import the data using the url and `readr`

```{r orginal_starwars}
library(readr)
orginal_starwars <- read_csv("https://bit.ly/mini-strwrs")
```

--

### This loads the dataset into our ***Environment*** pane

```{r starwars-env, out.height='90%', out.width='90%', echo=FALSE}
knitr::include_graphics(path = "img/starwars-env.png")
```

---
class: left, top
background-image: url(img/dplyr.png)
background-position: 90% 10%
background-size: 9%

# `dplyr` verbs

### The primary verbs for data manipulation in `dplyr`:

### `glimpse()`

### `select()` 

### `filter()`  

### `arrange()` 

### `mutate()`


---
class: inverse, center, middle
background-image: url(img/dplyr.png)
background-position: 50% 10%
background-size: 25%

# Viewing the data = `glimpse()`


---
class: left, top
background-image: url(img/dplyr.png)
background-position: 5% 95%
background-size: 7%

# View = `glimpse()`

#### Take a look at the dataset using `dplyr::glimpse()`

--

```{r orginal_starwars-glimpse}
glimpse(orginal_starwars)
```

#### `glimpse()` transposes the data and prints as much of it to the screen as possible

---
class: left, top
background-image: url(img/dplyr.png)
background-position: 5% 95%
background-size: 7%

## View the data in the ***Console***

*Enter the name of the data into the Console*

```{r console-orginal_starwars, eval=FALSE}
orginal_starwars
```

--

```{r paged_table_orginal_starwars, echo=FALSE}
rmarkdown::paged_table(orginal_starwars)
```


---
class: left, top
background-image: url(img/dplyr.png)
background-position: 5% 95%
background-size: 7%

## View the data in the *Data Viewer*

#### View the `orginal_starwars` dataset using RStudio's data editor

```{r starwars-dataviewer, out.height='80%', out.width='80%', echo=FALSE}
knitr::include_graphics(path = "img/starwars-dataviewer.png")
```

---
class: inverse, center, middle
background-image: url(img/dplyr.png)
background-position: 50% 10%
background-size: 25%

# Choosing columns = `select()`

---
class: left, top
background-image: url(img/dplyr.png)
background-position: 95% 15%
background-size: 9%

## Choose columns with `select()`

#### `select()` allows us to pick specific columns out of a dataset

```{r select-no-show-01, eval=FALSE}
select(original_starwars, name, homeworld, species)
```

--

```{r select-01, echo=FALSE}
rmarkdown::paged_table(
select(.data = orginal_starwars, name, homeworld, species)
)
```

---
class: left, top
background-image: url(img/dplyr.png)
background-position: 95% 15%
background-size: 9%

## Choose columns with `select()`

#### We can use negation to remove columns

```{r select-no-show-02, eval=FALSE}
select(orginal_starwars, -c(mass, height, gender))
```

--

```{r select-02, echo=FALSE}
rmarkdown::paged_table(
select(orginal_starwars, -c(mass, height, gender)))
```


---
class: inverse, center, middle
background-image: url(img/dplyr.png)
background-position: 50% 10%
background-size: 25%

# Choosing rows with `filter()`

---
class: left, top
background-image: url(img/dplyr.png)
background-position: 8% 94%
background-size: 7%

# Choose rows with `filter()` 

### `filter()` lets us pull out rows based on logical conditions

```{r filter-no-show, eval=FALSE}
filter(orginal_starwars, species == "Human")
```

--

```{r filter-02, echo=FALSE}
rmarkdown::paged_table(
filter(orginal_starwars, species == "Human"))
```

---
class: left top
background-image: url(img/dplyr.png)
background-position: 7% 95%
background-size: 9%

# Choose rows with `filter()` 

### `filter()` conditions include: 

Logical Test        | Outputs
:--------------:    | :--------------------------:
`<`                 | Less than
`>`                 | Greater than
`==`                | Equal to
`<=`                | Less than or equal to
`>=`                | Greater than or equal to
`!=`                | Not equal to
`%in%`              | Group membership
`is.na()`           | is NA (missing)
`!is.na()`          | is NOT NA (non-missing)


---
class: left, top
background-image: url(img/dplyr.png)
background-position: 7% 95%
background-size: 9%

# Choose rows with `filter()` 

### We can combine logical condtions with `&` or `,` 

```{r , eval=FALSE}

```



 
  


---
class: left, top
background-image: url(img/dplyr.png)
background-position: 7% 95%
background-size: 9%

# Sort rows with `arrange()`

---
class: left, top
background-image: url(img/dplyr.png)
background-position: 7% 95%
background-size: 9%

# Create columns with `mutate()`